<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIL Music Memory Practice 2025-2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .toggle-label {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            cursor: pointer;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 26px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .progress {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .progress-text {
            font-size: 18px;
            color: #667eea;
            font-weight: bold;
        }
        
        .navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            background: #667eea;
            color: white;
            min-width: 120px;
        }
        
        .nav-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .play-btn {
            background: #4CAF50;
            min-width: 150px;
        }
        
        .play-btn:hover:not(:disabled) {
            background: #45a049;
        }
        
        .spelling-section {
            margin-bottom: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
            display: none;
        }
        
        .spelling-section.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .input-wrapper {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .spelling-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
        }
        
        .spelling-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .accent-btn {
            padding: 8px 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .accent-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .feedback {
            margin-top: 5px;
            font-size: 13px;
            min-height: 20px;
        }
        
        .feedback.correct {
            color: #4CAF50;
            font-weight: 500;
        }
        
        .feedback.incorrect {
            color: #f44336;
        }
        
        .diff-display {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 8px;
            border-radius: 4px;
            margin-top: 5px;
            word-break: break-all;
        }
        
        .char-correct {
            color: #4CAF50;
        }
        

        
        .char-missing {
            display: inline-block;
            width: 0.5em;
            color: #424242;
            text-align: center;
        }
        
        .char-missing::before {
            content: '_';
            color: #424242;
        }
        
        .char-extra {
            background: #ffcdd2;
            text-decoration: line-through;
            padding: 2px 1px;
        }
        
        .check-btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .check-btn:hover {
            background: #5568d3;
        }
        
        .check-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .info-box {
            min-height: 120px;
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .info-box.hidden {
            color: #999;
        }
        
        .composer {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .selection {
            font-size: 18px;
            color: #666;
        }
        
        .reveal-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .reveal-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            background: #667eea;
            color: white;
        }
        
        .reveal-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .reveal-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .completion {
            text-align: center;
            padding: 30px;
        }
        
        .completion h2 {
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .restart-btn {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            margin-top: 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .restart-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>UIL Music Memory Practice</h1>
        <div class="subtitle">5th Grade ‚Ä¢ 2025-2026</div>
        
        <div class="toggle-container">
            <span class="toggle-label">Spelling Practice Mode</span>
            <label class="toggle-switch">
                <input type="checkbox" id="spellingToggle">
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="progress">
            <div class="progress-text" id="progressText">Listened: 0 of 16</div>
        </div>
        
        <div class="navigation">
            <button class="nav-btn" id="backBtn" disabled>‚Üê Back</button>
            <button class="nav-btn play-btn" id="playBtn">Play Clip</button>
            <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
        </div>
        
        <div class="spelling-section" id="spellingSection">
            <div class="input-group">
                <label class="input-label">Composer:</label>
                <div class="input-wrapper">
                    <input type="text" class="spelling-input" id="composerInput" placeholder="Enter composer name">
                    <button class="accent-btn" data-char="√©">√©</button>
                    <button class="accent-btn" data-char="√®">√®</button>
                </div>
                <div class="feedback" id="composerFeedback"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label">Major Work - Selection:</label>
                <div class="input-wrapper">
                    <input type="text" class="spelling-input" id="selectionInput" placeholder="Enter major work and selection">
                    <button class="accent-btn" data-char="√©">√©</button>
                    <button class="accent-btn" data-char="√®">√®</button>
                </div>
                <div class="feedback" id="selectionFeedback"></div>
            </div>
            
            <button class="check-btn" id="checkSpellingBtn">Check Spelling</button>
        </div>
        
        <div class="info-box hidden" id="infoBox">
            <div>Click "Play Clip" to begin</div>
        </div>
        
        <div class="reveal-controls" id="revealControls">
            <button class="reveal-btn" id="revealComposer" disabled>Reveal Composer</button>
            <button class="reveal-btn" id="revealSelection" disabled>Reveal Selection</button>
            <button class="reveal-btn" id="revealBoth" disabled>Reveal Both</button>
        </div>
        
        <div class="completion" id="completion" style="display: none;">
            <h2>üéâ You've completed all 16 tracks!</h2>
            <p>Ready to practice again?</p>
            <button class="restart-btn" id="restartBtn">Start Over</button>
        </div>
    </div>
    
    <audio id="audio"></audio>
    
    <script>
        const pieces = [
            { filename: "01 Rodeo - Hoe-Down by Copland.mp3", composer: "Copland", majorWork: "Rodeo", selection: "Hoe-Down" },
            { filename: "02 Exsultate, jubilate - Alleluia by Mozart.mp3", composer: "Mozart", majorWork: "Exsultate, jubilate", selection: "Alleluia" },
            { filename: "03 Suite No. 2 - March by Holst.mp3", composer: "Holst", majorWork: "Suite No. 2", selection: "March" },
            { filename: "04 Maple Leaf Rag by Joplin.mp3", composer: "Joplin", majorWork: null, selection: "Maple Leaf Rag" },
            { filename: "05 Concerto for 2 Violins in D Minor, Double - Movement 1 by Bach.mp3", composer: "Bach", majorWork: "Concerto for 2 Violins in D Minor, \"Double\"", selection: "Movement 1" },
            { filename: "06 The Red Poppy - Russian Sailor's Dance by Gliere.mp3", composer: "Gli√®re", majorWork: "The Red Poppy", selection: "Russian Sailor's Dance" },
            { filename: "07 Railroad (Travel Song) by M Monk.mp3", composer: "M. Monk", majorWork: null, selection: "Railroad (Travel Song)" },
            { filename: "08 Also sprach Zarathustra - Introduction by R Strauss.mp3", composer: "R. Strauss", majorWork: "Also sprach Zarathustra", selection: "Introduction" },
            { filename: "09 Symphony No. 5, Fate - Movement 1 by Beethoven.mp3", composer: "Beethoven", majorWork: "Symphony No. 5, \"Fate\"", selection: "Movement 1" },
            { filename: "10 Holberg Suite - Prelude by Grieg.mp3", composer: "Grieg", majorWork: "Holberg Suite", selection: "Prelude" },
            { filename: "11 Missa Hodie Christus natus est, Christmas Mass - Kyrie by Palestrina.mp3", composer: "Palestrina", majorWork: "Missa Hodie Christus natus est, \"Christmas Mass\"", selection: "Kyrie" },
            { filename: "12 Requiem - Pie Jesu by Webber.mp3", composer: "Webber", majorWork: "Requiem", selection: "Pie Jesu" },
            { filename: "13 Polonaise in A Major, Military by Chopin.mp3", composer: "Chopin", majorWork: null, selection: "Polonaise in A Major, \"Military\"" },
            { filename: "14 Table Music - Part 1 - Overture - Movement 3. Rondeau by Telemann.mp3", composer: "Telemann", majorWork: "Table Music: Part 1 - Overture", selection: "Movement 3. Rondeau" },
            { filename: "15 Requiem in D Minor - Pie Jesu by Faure.mp3", composer: "Faur√©", majorWork: "Requiem in D Minor", selection: "Pie Jesu" },
            { filename: "16 American Salute by Gould.mp3", composer: "Gould", majorWork: null, selection: "American Salute" }
        ];
        
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        let shuffledPieces = shuffleArray(pieces);
        let currentIndex = 0;
        let isPlaying = false;
        let clipTimeout = null;
        let audioLoaded = false;
        let audioDuration = 0;
        let clipStartTime = 10;
        let hasPlayedOnce = false;
        let clipStartTimes = [];
        let isPaused = false;
        let pausedTime = 0;
        let spellingMode = false;
        let trackInputs = {}; // Store inputs for each track
        
        const audio = document.getElementById('audio');
        const playBtn = document.getElementById('playBtn');
        const backBtn = document.getElementById('backBtn');
        const nextBtn = document.getElementById('nextBtn');
        const infoBox = document.getElementById('infoBox');
        const revealComposer = document.getElementById('revealComposer');
        const revealSelection = document.getElementById('revealSelection');
        const revealBoth = document.getElementById('revealBoth');
        const progressText = document.getElementById('progressText');
        const completion = document.getElementById('completion');
        const restartBtn = document.getElementById('restartBtn');
        const revealControls = document.getElementById('revealControls');
        const spellingToggle = document.getElementById('spellingToggle');
        const spellingSection = document.getElementById('spellingSection');
        const composerInput = document.getElementById('composerInput');
        const selectionInput = document.getElementById('selectionInput');
        const checkSpellingBtn = document.getElementById('checkSpellingBtn');
        const composerFeedback = document.getElementById('composerFeedback');
        const selectionFeedback = document.getElementById('selectionFeedback');
        
        // Accent button handlers
        document.querySelectorAll('.accent-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const char = btn.dataset.char;
                const input = btn.parentElement.querySelector('.spelling-input');
                const start = input.selectionStart;
                const end = input.selectionEnd;
                const text = input.value;
                input.value = text.substring(0, start) + char + text.substring(end);
                input.focus();
                input.selectionStart = input.selectionEnd = start + 1;
            });
        });
        
        spellingToggle.addEventListener('change', () => {
            spellingMode = spellingToggle.checked;
            if (spellingMode) {
                spellingSection.classList.add('active');
                restoreInputs();
            } else {
                spellingSection.classList.remove('active');
            }
        });
        
        function saveInputs() {
            trackInputs[currentIndex] = {
                composer: composerInput.value,
                selection: selectionInput.value,
                composerFeedback: composerFeedback.innerHTML,
                selectionFeedback: selectionFeedback.innerHTML
            };
        }
        
        function restoreInputs() {
            const saved = trackInputs[currentIndex];
            if (saved) {
                composerInput.value = saved.composer;
                selectionInput.value = saved.selection;
                composerFeedback.innerHTML = saved.composerFeedback;
                selectionFeedback.innerHTML = saved.selectionFeedback;
            } else {
                composerInput.value = '';
                selectionInput.value = '';
                composerFeedback.innerHTML = '';
                selectionFeedback.innerHTML = '';
            }
        }
        
        function formatSelection(piece) {
            if (piece.majorWork) {
                return `${piece.majorWork} - ${piece.selection}`;
            }
            return piece.selection;
        }
        
        function compareStrings(input, correct) {
            // Use dynamic programming to find the best alignment
            const m = input.length;
            const n = correct.length;
            
            // dp[i][j] represents the edit distance between input[0..i-1] and correct[0..j-1]
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));
            const path = Array(m + 1).fill(null).map(() => Array(n + 1).fill(null));
            
            // Initialize base cases
            for (let i = 0; i <= m; i++) {
                dp[i][0] = i;
                path[i][0] = 'delete';
            }
            for (let j = 0; j <= n; j++) {
                dp[0][j] = j;
                path[0][j] = 'insert';
            }
            
            // Fill the dp table
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (input[i - 1] === correct[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1];
                        path[i][j] = 'match';
                    } else {
                        const deleteCost = dp[i - 1][j] + 1;
                        const insertCost = dp[i][j - 1] + 1;
                        const replaceCost = dp[i - 1][j - 1] + 1;
                        
                        if (deleteCost <= insertCost && deleteCost <= replaceCost) {
                            dp[i][j] = deleteCost;
                            path[i][j] = 'delete';
                        } else if (insertCost <= replaceCost) {
                            dp[i][j] = insertCost;
                            path[i][j] = 'insert';
                        } else {
                            dp[i][j] = replaceCost;
                            path[i][j] = 'replace';
                        }
                    }
                }
            }
            
            // Backtrack to build the result
            let html = '';
            let i = m, j = n;
            const operations = [];
            
            while (i > 0 || j > 0) {
                const op = path[i][j];
                if (op === 'match') {
                    operations.unshift({ type: 'match', char: input[i - 1] });
                    i--;
                    j--;
                } else if (op === 'delete') {
                    operations.unshift({ type: 'delete', char: input[i - 1] });
                    i--;
                } else if (op === 'insert') {
                    operations.unshift({ type: 'insert' });
                    j--;
                } else if (op === 'replace') {
                    operations.unshift({ type: 'replace', char: input[i - 1] });
                    i--;
                    j--;
                }
            }
            
            // Generate HTML from operations
            for (const op of operations) {
                if (op.type === 'match') {
                    html += `<span class="char-correct">${op.char}</span>`;
                } else if (op.type === 'delete') {
                    html += `<span class="char-extra">${op.char}</span>`;
                } else if (op.type === 'insert' || op.type === 'replace') {
                    html += `<span class="char-missing">‚ñà</span>`;
                }
            }
            
            return html;
        }
        
        // Remove old findLCS function - no longer needed
        
        checkSpellingBtn.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            const composerCorrect = piece.composer;
            const selectionCorrect = formatSelection(piece);
            
            const composerInput = document.getElementById('composerInput').value;
            const selectionInput = document.getElementById('selectionInput').value;
            
            // Check composer
            if (composerInput === composerCorrect) {
                composerFeedback.className = 'feedback correct';
                composerFeedback.innerHTML = '‚úì Correct!';
            } else {
                composerFeedback.className = 'feedback incorrect';
                const diff = compareStrings(composerInput, composerCorrect);
                composerFeedback.innerHTML = `‚úó Incorrect<div class="diff-display">${diff}</div>`;
            }
            
            // Check selection
            if (selectionInput === selectionCorrect) {
                selectionFeedback.className = 'feedback correct';
                selectionFeedback.innerHTML = '‚úì Correct!';
            } else {
                selectionFeedback.className = 'feedback incorrect';
                const diff = compareStrings(selectionInput, selectionCorrect);
                selectionFeedback.innerHTML = `‚úó Incorrect<div class="diff-display">${diff}</div>`;
            }
            
            saveInputs();
        });
        
        function loadTrack() {
            const piece = shuffledPieces[currentIndex];
            const audioFile = `audio/${piece.filename}`;
            
            audio.src = audioFile;
            audioLoaded = false;
            hasPlayedOnce = false;
            isPaused = false;
            pausedTime = 0;
            
            infoBox.classList.add('hidden');
            infoBox.innerHTML = '<div>Loading track...</div>';
            
            playBtn.disabled = true;
            playBtn.textContent = 'Play Clip';
            revealComposer.disabled = true;
            revealSelection.disabled = true;
            revealBoth.disabled = true;
            
            if (spellingMode) {
                restoreInputs();
            }
            
            audio.load();
        }
        
        audio.addEventListener('loadedmetadata', () => {
            audioLoaded = true;
            audioDuration = audio.duration;
            
            if (clipStartTimes[currentIndex] === undefined) {
                const maxStartTime = Math.max(10, audioDuration - 20);
                const minStartTime = 10;
                
                if (audioDuration <= 30) {
                    clipStartTime = minStartTime;
                } else {
                    clipStartTime = minStartTime + Math.random() * (maxStartTime - minStartTime);
                }
                
                clipStartTimes[currentIndex] = clipStartTime;
            } else {
                clipStartTime = clipStartTimes[currentIndex];
            }
            
            playBtn.disabled = false;
            infoBox.innerHTML = '<div>Click "Play Clip" to hear the music</div>';
            updateProgress();
        });
        
        audio.addEventListener('error', () => {
            infoBox.innerHTML = '<div style="color: #f44336;">Error loading audio file. Check that the file exists in the audio folder.</div>';
        });
        
        function updateProgress() {
            const listenedCount = hasPlayedOnce ? currentIndex + 1 : currentIndex;
            progressText.textContent = `Listened: ${listenedCount} of ${shuffledPieces.length}`;
            backBtn.disabled = currentIndex === 0;
            nextBtn.disabled = false;
        }
        
        function playClip() {
            if (!audioLoaded) return;
            
            if (isPaused) {
                audio.currentTime = pausedTime;
                isPaused = false;
            } else {
                audio.currentTime = clipStartTime;
            }
            
            audio.play();
            isPlaying = true;
            hasPlayedOnce = true;
            playBtn.textContent = 'Pause';
            
            revealComposer.disabled = false;
            revealSelection.disabled = false;
            revealBoth.disabled = false;
            
            infoBox.classList.add('hidden');
            infoBox.innerHTML = '<div>Listening...</div>';
            
            if (currentIndex > 0 || hasPlayedOnce) {
                updateProgress();
            }
            
            const currentOffset = audio.currentTime - clipStartTime;
            const remainingTime = Math.max(0, 20000 - (currentOffset * 1000));
            
            if (clipTimeout) clearTimeout(clipTimeout);
            clipTimeout = setTimeout(() => {
                audio.pause();
                isPlaying = false;
                isPaused = false;
                playBtn.textContent = 'Replay Clip';
                infoBox.innerHTML = '<div>Click reveal buttons to check your answer</div>';
            }, remainingTime);
        }
        
        function pauseClip() {
            pausedTime = audio.currentTime;
            isPaused = true;
            audio.pause();
            isPlaying = false;
            playBtn.textContent = 'Resume';
            if (clipTimeout) {
                clearTimeout(clipTimeout);
                clipTimeout = null;
            }
        }
        
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                pauseClip();
            } else {
                playClip();
            }
        });
        
        backBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                if (spellingMode) saveInputs();
                pauseClip();
                isPaused = false;
                currentIndex--;
                loadTrack();
                const checkLoaded = setInterval(() => {
                    if (audioLoaded) {
                        clearInterval(checkLoaded);
                        playClip();
                    }
                }, 50);
            }
        });
        
        nextBtn.addEventListener('click', () => {
            if (currentIndex < shuffledPieces.length - 1) {
                if (spellingMode) saveInputs();
                pauseClip();
                isPaused = false;
                currentIndex++;
                loadTrack();
                const checkLoaded = setInterval(() => {
                    if (audioLoaded) {
                        clearInterval(checkLoaded);
                        playClip();
                    }
                }, 50);
            } else {
                pauseClip();
                document.querySelector('.progress').style.display = 'none';
                document.querySelector('.navigation').style.display = 'none';
                document.querySelector('.toggle-container').style.display = 'none';
                spellingSection.style.display = 'none';
                infoBox.style.display = 'none';
                revealControls.style.display = 'none';
                completion.style.display = 'block';
            }
        });
        
        revealComposer.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            infoBox.classList.remove('hidden');
            infoBox.innerHTML = `<div class="composer">${piece.composer}</div>`;
        });
        
        revealSelection.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            infoBox.classList.remove('hidden');
            infoBox.innerHTML = `<div class="selection">${formatSelection(piece)}</div>`;
        });
        
        revealBoth.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            infoBox.classList.remove('hidden');
            infoBox.innerHTML = `
                <div class="composer">${piece.composer}</div>
                <div class="selection">${formatSelection(piece)}</div>
            `;
        });
        
        restartBtn.addEventListener('click', () => {
            currentIndex = 0;
            clipStartTimes = [];
            isPaused = false;
            pausedTime = 0;
            trackInputs = {};
            shuffledPieces = shuffleArray(pieces);
            document.querySelector('.progress').style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.toggle-container').style.display = 'flex';
            if (spellingMode) {
                spellingSection.style.display = 'block';
            }
            infoBox.style.display = 'flex';
            revealControls.style.display = 'flex';
            completion.style.display = 'none';
            loadTrack();
        });
        
        loadTrack();
    </script>
</body>
</html>
