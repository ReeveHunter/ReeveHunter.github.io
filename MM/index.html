<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIL Music Memory Practice 2025-2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .progress {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .progress-text {
            font-size: 18px;
            color: #667eea;
            font-weight: bold;
        }
        
        .navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            background: #667eea;
            color: white;
            min-width: 120px;
        }
        
        .nav-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .play-btn {
            background: #4CAF50;
            min-width: 150px;
        }
        
        .play-btn:hover:not(:disabled) {
            background: #45a049;
        }
        
        .info-box {
            min-height: 120px;
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .info-box.hidden {
            color: #999;
        }
        
        .composer {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .selection {
            font-size: 18px;
            color: #666;
        }
        
        .reveal-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .reveal-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            background: #667eea;
            color: white;
        }
        
        .reveal-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .reveal-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .completion {
            text-align: center;
            padding: 30px;
        }
        
        .completion h2 {
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .restart-btn {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            margin-top: 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .restart-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>UIL Music Memory Practice</h1>
        <div class="subtitle">5th Grade ‚Ä¢ 2025-2026</div>
        
        <div class="progress">
            <div class="progress-text" id="progressText">Listened: 0 of 16</div>
        </div>
        
        <div class="navigation">
            <button class="nav-btn" id="backBtn" disabled>‚Üê Back</button>
            <button class="nav-btn play-btn" id="playBtn">Play Clip</button>
            <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
        </div>
        
        <div class="info-box hidden" id="infoBox">
            <div>Click "Play Clip" to begin</div>
        </div>
        
        <div class="reveal-controls" id="revealControls">
            <button class="reveal-btn" id="revealComposer" disabled>Reveal Composer</button>
            <button class="reveal-btn" id="revealSelection" disabled>Reveal Selection</button>
            <button class="reveal-btn" id="revealBoth" disabled>Reveal Both</button>
        </div>
        
        <div class="completion" id="completion" style="display: none;">
            <h2>üéâ You've completed all 16 tracks!</h2>
            <p>Ready to practice again?</p>
            <button class="restart-btn" id="restartBtn">Start Over</button>
        </div>
    </div>
    
    <audio id="audio"></audio>
    
    <script>
        const pieces = [
            { filename: "01 Rodeo - Hoe-Down by Copland.mp3", composer: "Copland", majorWork: "Rodeo", selection: "Hoe-Down" },
            { filename: "02 Exsultate, jubilate - Alleluia by Mozart.mp3", composer: "Mozart", majorWork: "Exsultate, jubilate", selection: "Alleluia" },
            { filename: "03 Suite No. 2 - March by Holst.mp3", composer: "Holst", majorWork: "Suite No. 2", selection: "March" },
            { filename: "04 Maple Leaf Rag by Joplin.mp3", composer: "Joplin", majorWork: null, selection: "Maple Leaf Rag" },
            { filename: "05 Concerto for 2 Violins in D Minor, Double - Movement 1 by Bach.mp3", composer: "Bach", majorWork: "Concerto for 2 Violins in D Minor, \"Double\"", selection: "Movement 1" },
            { filename: "06 The Red Poppy - Russian Sailor's Dance by Gliere.mp3", composer: "Gli√®re", majorWork: "The Red Poppy", selection: "Russian Sailor's Dance" },
            { filename: "07 Railroad (Travel Song) by M Monk.mp3", composer: "M. Monk", majorWork: null, selection: "Railroad (Travel Song)" },
            { filename: "08 Also sprach Zarathustra - Introduction by R Strauss.mp3", composer: "R. Strauss", majorWork: "Also sprach Zarathustra", selection: "Introduction" },
            { filename: "09 Symphony No. 5, Fate - Movement 1 by Beethoven.mp3", composer: "Beethoven", majorWork: "Symphony No. 5, \"Fate\"", selection: "Movement 1" },
            { filename: "10 Holberg Suite - Prelude by Grieg.mp3", composer: "Grieg", majorWork: "Holberg Suite", selection: "Prelude" },
            { filename: "11 Missa Hodie Christus natus est, Christmas Mass - Kyrie by Palestrina.mp3", composer: "Palestrina", majorWork: "Missa Hodie Christus natus est, \"Christmas Mass\"", selection: "Kyrie" },
            { filename: "12 Requiem - Pie Jesu by Webber.mp3", composer: "Webber", majorWork: "Requiem", selection: "Pie Jesu" },
            { filename: "13 Polonaise in A Major, Military by Chopin.mp3", composer: "Chopin", majorWork: null, selection: "Polonaise in A Major, \"Military\"" },
            { filename: "14 Table Music - Part 1 - Overture - Movement 3. Rondeau by Telemann.mp3", composer: "Telemann", majorWork: "Table Music: Part 1 - Overture", selection: "Movement 3. Rondeau" },
            { filename: "15 Requiem in D Minor - Pie Jesu by Faure.mp3", composer: "Faur√©", majorWork: "Requiem in D Minor", selection: "Pie Jesu" },
            { filename: "16 American Salute by Gould.mp3", composer: "Gould", majorWork: null, selection: "American Salute" }
        ];
        
        // Shuffle the pieces array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        let shuffledPieces = shuffleArray(pieces);
        
        let currentIndex = 0;
        let isPlaying = false;
        let clipTimeout = null;
        let audioLoaded = false;
        let audioDuration = 0;
        let clipStartTime = 10;
        let hasPlayedOnce = false;
        let clipStartTimes = []; // Store start times for each track
        let isPaused = false;
        let pausedTime = 0;
        
        const audio = document.getElementById('audio');
        const playBtn = document.getElementById('playBtn');
        const backBtn = document.getElementById('backBtn');
        const nextBtn = document.getElementById('nextBtn');
        const infoBox = document.getElementById('infoBox');
        const revealComposer = document.getElementById('revealComposer');
        const revealSelection = document.getElementById('revealSelection');
        const revealBoth = document.getElementById('revealBoth');
        const progressText = document.getElementById('progressText');
        const completion = document.getElementById('completion');
        const restartBtn = document.getElementById('restartBtn');
        const revealControls = document.getElementById('revealControls');
        
        function loadTrack() {
            const piece = shuffledPieces[currentIndex];
            const audioFile = `audio/${piece.filename}`;
            
            audio.src = audioFile;
            audioLoaded = false;
            hasPlayedOnce = false;
            isPaused = false;
            pausedTime = 0;
            
            // Reset display
            infoBox.classList.add('hidden');
            infoBox.innerHTML = '<div>Loading track...</div>';
            
            // Disable buttons while loading
            playBtn.disabled = true;
            playBtn.textContent = 'Play Clip';
            revealComposer.disabled = true;
            revealSelection.disabled = true;
            revealBoth.disabled = true;
            
            audio.load();
        }
        
        audio.addEventListener('loadedmetadata', () => {
            audioLoaded = true;
            audioDuration = audio.duration;
            
            // Check if we already have a start time for this track
            if (clipStartTimes[currentIndex] === undefined) {
                // Calculate safe start time for 20 second clip
                // Skip first 10 seconds, but ensure we have 20 seconds of audio left
                const maxStartTime = Math.max(10, audioDuration - 20);
                const minStartTime = 10;
                
                if (audioDuration <= 30) {
                    // If audio is too short, use what we have
                    clipStartTime = minStartTime;
                } else {
                    // Random start time between 10 seconds and (duration - 20 seconds)
                    clipStartTime = minStartTime + Math.random() * (maxStartTime - minStartTime);
                }
                
                // Store this start time
                clipStartTimes[currentIndex] = clipStartTime;
            } else {
                // Use the previously stored start time
                clipStartTime = clipStartTimes[currentIndex];
            }
            
            playBtn.disabled = false;
            infoBox.innerHTML = '<div>Click "Play Clip" to hear the music</div>';
            updateProgress();
        });
        
        audio.addEventListener('error', () => {
            infoBox.innerHTML = '<div style="color: #f44336;">Error loading audio file. Check that the file exists in the audio folder.</div>';
        });
        
        function updateProgress() {
            // Show how many have been listened to (current position + 1 when playing)
            const listenedCount = hasPlayedOnce ? currentIndex + 1 : currentIndex;
            progressText.textContent = `Listened: ${listenedCount} of ${shuffledPieces.length}`;
            backBtn.disabled = currentIndex === 0;
            nextBtn.disabled = false;
        }
        
        function formatSelection(piece) {
            if (piece.majorWork) {
                return `${piece.majorWork} - ${piece.selection}`;
            }
            return piece.selection;
        }
        
        function playClip() {
            if (!audioLoaded) return;
            
            // If resuming from pause, continue from paused position
            if (isPaused) {
                audio.currentTime = pausedTime;
                isPaused = false;
            } else {
                // Starting fresh - go to the clip start time
                audio.currentTime = clipStartTime;
            }
            
            audio.play();
            isPlaying = true;
            hasPlayedOnce = true;
            playBtn.textContent = 'Pause';
            
            // Enable reveal buttons after first play
            revealComposer.disabled = false;
            revealSelection.disabled = false;
            revealBoth.disabled = false;
            
            infoBox.classList.add('hidden');
            infoBox.innerHTML = '<div>Listening...</div>';
            
            // Update progress to show we've listened to this one
            if (currentIndex > 0 || hasPlayedOnce) {
                updateProgress();
            }
            
            // Calculate remaining time in the 20-second clip
            const currentOffset = audio.currentTime - clipStartTime;
            const remainingTime = Math.max(0, 20000 - (currentOffset * 1000));
            
            // Stop after remaining time
            if (clipTimeout) clearTimeout(clipTimeout);
            clipTimeout = setTimeout(() => {
                audio.pause();
                isPlaying = false;
                isPaused = false;
                playBtn.textContent = 'Replay Clip';
                infoBox.innerHTML = '<div>Click reveal buttons to check your answer</div>';
            }, remainingTime);
        }
        
        function pauseClip() {
            pausedTime = audio.currentTime;
            isPaused = true;
            audio.pause();
            isPlaying = false;
            playBtn.textContent = 'Resume';
            if (clipTimeout) {
                clearTimeout(clipTimeout);
                clipTimeout = null;
            }
        }
        
        playBtn.addEventListener('click', () => {
            if (isPlaying) {
                pauseClip();
            } else {
                playClip();
            }
        });
        
        backBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                pauseClip();
                isPaused = false;
                currentIndex--;
                loadTrack();
                // Wait for audio to load, then auto-play
                const checkLoaded = setInterval(() => {
                    if (audioLoaded) {
                        clearInterval(checkLoaded);
                        playClip();
                    }
                }, 50);
            }
        });
        
        nextBtn.addEventListener('click', () => {
            if (currentIndex < shuffledPieces.length - 1) {
                pauseClip();
                isPaused = false;
                currentIndex++;
                loadTrack();
                // Wait for audio to load, then auto-play
                const checkLoaded = setInterval(() => {
                    if (audioLoaded) {
                        clearInterval(checkLoaded);
                        playClip();
                    }
                }, 50);
            } else {
                // Show completion
                pauseClip();
                document.querySelector('.progress').style.display = 'none';
                document.querySelector('.navigation').style.display = 'none';
                infoBox.style.display = 'none';
                revealControls.style.display = 'none';
                completion.style.display = 'block';
            }
        });
        
        revealComposer.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            infoBox.classList.remove('hidden');
            infoBox.innerHTML = `<div class="composer">${piece.composer}</div>`;
        });
        
        revealSelection.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            infoBox.classList.remove('hidden');
            infoBox.innerHTML = `<div class="selection">${formatSelection(piece)}</div>`;
        });
        
        revealBoth.addEventListener('click', () => {
            const piece = shuffledPieces[currentIndex];
            infoBox.classList.remove('hidden');
            infoBox.innerHTML = `
                <div class="composer">${piece.composer}</div>
                <div class="selection">${formatSelection(piece)}</div>
            `;
        });
        
        restartBtn.addEventListener('click', () => {
            currentIndex = 0;
            clipStartTimes = []; // Reset stored start times
            isPaused = false;
            pausedTime = 0;
            shuffledPieces = shuffleArray(pieces); // Reshuffle for new session
            document.querySelector('.progress').style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            infoBox.style.display = 'flex';
            revealControls.style.display = 'flex';
            completion.style.display = 'none';
            loadTrack();
        });
        
        // Initialize
        loadTrack();
    </script>
</body>
</html>
